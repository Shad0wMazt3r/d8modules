<?php

use Drupal\Component\Serialization\Yaml;
use function Drupal\Core\Session\user_role_permissions;

/**
 * Implements hook_install().
 */

function webform_permissions_install() {
  user_role_grant_permissions('authenticated', ['view the administration theme']);

  user_role_grant_permissions('content_editor', [
    'view the administration theme',
    'access webform overview',
    'access webform submission user',
    'create webform',
    'delete any webform',
    'delete any webform submission',
    'edit any webform',
    'edit any webform submission',
    'view any webform submission',
  ]);

  $config = \Drupal::service('config.factory')->getEditable('system.mail');
  if (!empty($config)) {
    Drupal::logger('webform_permissions')->info('Have the config');
    $config->set('interface.webform', 'webform_php_mail_22');
    $config->save();
  }

  $config_files = [
'honeypot.settings',
'system.action.webform_submission_delete_action',
'system.action.webform_submission_make_lock_action',
'system.action.webform_submission_make_sticky_action',
'system.action.webform_submission_make_unlock_action',
'system.action.webform_submission_make_unsticky_action',
'views.view.webform_submissions',
'webform.settings',
'webform.webform.contact',
'webform.webform_options.country_codes',
'webform.webform_options.country_names',
'webform.webform_options.days',
'webform.webform_options.education',
'webform.webform_options.employment_status',
'webform.webform_options.ethnicity',
'webform.webform_options.gender',
'webform.webform_options.industry',
'webform.webform_options.languages',
'webform.webform_options.likert_agreement',
'webform.webform_options.likert_comparison',
'webform.webform_options.likert_importance',
'webform.webform_options.likert_quality',
'webform.webform_options.likert_satisfaction',
'webform.webform_options.likert_ten_scale',
'webform.webform_options.likert_would_you',
'webform.webform_options.marital_status',
'webform.webform_options.months',
'webform.webform_options.phone_types',
'webform.webform_options.province_codes',
'webform.webform_options.province_names',
'webform.webform_options.relationship',
'webform.webform_options.size',
'webform.webform_options.state_codes',
'webform.webform_options.state_names',
'webform.webform_options.state_province_codes',
'webform.webform_options.state_province_names',
'webform.webform_options.time_zones',
'webform.webform_options.titles',
'webform.webform_options.translations',
'webform.webform_options.yes_no',
'brian.settings'
  ];
  foreach ($config_files as $config_id) {
    $raw_data = file_get_contents(drupal_get_path('module', 'webform_permissions') . '/config/hook_install/' . $config_id . '.yml');
    \Drupal::configFactory()->getEditable($config_id)
      ->setData(Yaml::decode($raw_data))
      ->save();
      \Drupal::logger('webform_permissions')->info($config_id);
  }

}
